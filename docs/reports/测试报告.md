# 山东协议测试报告

## 测试时间
2024-12-29 13:40

## 测试环境
- 服务器地址：103.203.219.138:18086
- 测试工具：Python 3.6 + Socket
- 协议版本：HJ/T212-2005

## 测试结果

### 1. 网络连接测试
- ✅ **连接成功**
  - TCP连接正常
  - 延迟：6-9ms
  - 连接稳定性：良好

### 2. 数据包发送测试
- ✅ **发送成功**
  - 数据包大小：295-299字节
  - 发送成功率：100%
  - 服务器响应：正常

### 3. 服务器应答分析
- ⚠️ **应答内容**：`无法识别的数据类型`

## 测试的数据包格式

### 格式1（无QN，无数据段长度）
```
##ST=61;CN=3051;PW=123456;CP=&&MN=01010101010101;...&&CRC\r\n
```
**结果**：无法识别的数据类型

### 格式2（有QN，无数据段长度）
```
##QN=2025122913402906811;ST=61;CN=3051;PW=123456;CP=&&MN=01010101010101;...&&CRC\r\n
```
**结果**：无法识别的数据类型

### 格式3（有QN，有数据段长度）
```
##0287QN=2025122913405461821;ST=61;CN=3051;PW=123456;CP=&&MN=01010101010101;...&&CRC\r\n
```
**结果**：无法识别的数据类型

## 数据包内容示例（格式3）

```
##0287QN=2025122913405461821;ST=61;CN=3051;PW=123456;CP=&&MN=01010101010101;Ma=000001;Rno=010101010101;Xtype=01;LastAct=2.700E004;NowAct=1.300E004;SourceTime=20240101;DataTime=20251229134054;LONG=11225.1333;LAT=3705.4300;Xvalue=1000000.000;Thres=100000.000;AlertType=01;BattChar=1000.0;Sig=1&&D281\r\n
```

## 问题分析

### 可能的原因

1. **设备未注册** ⭐⭐⭐⭐⭐
   - 测试设备编号 `01010101010101` 可能在服务器端未注册
   - 服务器无法识别该设备，返回"无法识别的数据类型"
   - **建议**：使用已在服务器注册的真实设备编号进行测试

2. **数据格式细节差异** ⭐⭐⭐
   - 字段顺序可能不符合服务器预期
   - 某些字段值可能不符合要求（如放射源类型、报警类型等）
   - **建议**：对比服务器端其他设备的成功数据包

3. **协议版本差异** ⭐⭐
   - 服务器可能使用不同版本的协议
   - 部分字段定义可能有所变化
   - **建议**：确认服务器使用的协议版本

## 测试结论

### 服务器状态
✅ **服务器工作正常**
- TCP连接成功
- 能够接收并响应数据包
- 响应时间正常（<10ms）

### 问题所在
⚠️ **数据内容验证失败**
- 服务器返回"无法识别的数据类型"
- 很可能是测试设备未在服务器注册
- 需要使用已注册的真实设备编号

## 下一步建议

1. **获取真实设备信息** ⭐⭐⭐⭐⭐
   - 从服务器获取已注册的设备编号
   - 获取对应的探伤机编号、放射源编号
   - 获取正确的密码

2. **联系服务器管理员** ⭐⭐⭐⭐
   - 确认测试设备是否已注册
   - 获取服务器端日志
   - 确认协议版本和字段要求

3. **对比成功案例** ⭐⭐⭐⭐
   - 获取其他设备成功的上报数据包
   - 逐字段对比差异
   - 调整测试数据格式

4. **尝试其他测试方式** ⭐⭐⭐
   - 使用后端Java代码进行测试
   - 在后端添加详细的日志输出
   - 使用抓包工具对比数据包

## 附件

- 测试脚本：`test_shandong_quick.py`
- 协议文档：`参考/ems-backend/上报/另一个上报/上报2.txt`
- Java实现：`backend/src/main/java/com/cdutetc/ems/service/HJT212ProtocolService.java`

---

**测试人员**：Claude AI
**测试日期**：2024-12-29
**报告版本**：v1.0
