# å‰ç«¯æ•°æ®ä¸ŠæŠ¥é…ç½®è®¾è®¡æ–¹æ¡ˆ V2.0

## ğŸ“‹ æ ¸å¿ƒåŸåˆ™

### æƒé™è®¾è®¡ä¿®æ­£

| è§’è‰² | é…ç½®æƒé™ | è¯´æ˜ |
|------|----------|------|
| **ç”¨æˆ·ï¼ˆUSERï¼‰** | âœ… å¯é…ç½®è‡ªå·±è®¾å¤‡çš„ä¸ŠæŠ¥å‚æ•° | å®é™…ä½¿ç”¨è€…ï¼Œè‡ªå·±é…ç½® |
| **ç®¡ç†å‘˜ï¼ˆADMINï¼‰** | âœ… å¯é…ç½®æ‰€æœ‰è®¾å¤‡ + ç³»ç»Ÿçº§é…ç½® | ç‰¹æ®Šæƒ…å†µä¸‹ä»£é…ç½® + ç³»ç»Ÿå‚æ•° |

### é…ç½®å±‚çº§

1. **ç”¨æˆ·çº§é…ç½®**ï¼ˆç”¨æˆ·æ“ä½œï¼‰
   - è®¾å¤‡ä¸ŠæŠ¥å¼€å…³
   - ä¸ŠæŠ¥åè®®é€‰æ‹©
   - è¾å°„è®¾å¤‡ä¸“ç”¨å‚æ•°

2. **ç³»ç»Ÿçº§é…ç½®**ï¼ˆç®¡ç†å‘˜æ“ä½œï¼‰
   - å››å·åè®®ï¼šä¸ŠæŠ¥åœ°å€ã€APIå¯†é’¥ã€SM2å…¬é’¥
   - å±±ä¸œåè®®ï¼šTCPæœåŠ¡å™¨åœ°å€ã€ç«¯å£ã€å¯†ç 
   - è¶…æ—¶æ—¶é—´ç­‰

---

## ğŸ¯ é…ç½®é¡¹åˆ†ç±»

### ç”¨æˆ·çº§é…ç½®ï¼ˆè®¾å¤‡ä¸ŠæŠ¥å‚æ•°ï¼‰

#### åŸºç¡€é…ç½®ï¼ˆæ‰€æœ‰è®¾å¤‡ï¼‰

| é…ç½®é¡¹ | å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|--------|------|------|
| å¯ç”¨æ•°æ®ä¸ŠæŠ¥ | `dataReportEnabled` | Boolean | å¼€å…³ |
| ä¸ŠæŠ¥åè®® | `reportProtocol` | Enum | SICHUAN/SHANDONG |

#### è¾å°„è®¾å¤‡ä¸“ç”¨é…ç½®

**å››å·åè®®**ï¼š
- æ ¸ç´ ç±»å‹ `nuclide`

**å±±ä¸œåè®®**ï¼š
- æ¢ä¼¤æœºç¼–å· `inspectionMachineNumber`ï¼ˆ6ä½æ•°å­—ï¼‰
- æ”¾å°„æºç¼–å· `sourceNumber`ï¼ˆ12ä½æ•°å­—ï¼‰
- æ”¾å°„æºç±»åˆ« `sourceType`ï¼ˆ01-05ï¼‰
- åŸå§‹æ´»åº¦ `originalActivity`ï¼ˆç§‘å­¦è®¡æ•°æ³•ï¼‰
- å½“å‰æ´»åº¦ `currentActivity`ï¼ˆç§‘å­¦è®¡æ•°æ³•ï¼‰
- å‡ºå‚æ—¥æœŸ `sourceProductionDate`

#### åªè¯»ç»Ÿè®¡å­—æ®µ

- `lastReportTime` - æœ€åä¸ŠæŠ¥æ—¶é—´
- `lastReportStatus` - æœ€åä¸ŠæŠ¥çŠ¶æ€ï¼ˆSUCCESS/FAILEDï¼‰
- `totalReportCount` - æ€»ä¸ŠæŠ¥æ¬¡æ•°
- `successReportCount` - æˆåŠŸæ¬¡æ•°

### ç³»ç»Ÿçº§é…ç½®ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰

| åè®® | é…ç½®é¡¹ | å­—æ®µå | ç¤ºä¾‹å€¼ |
|------|--------|--------|--------|
| å››å· | ä¸ŠæŠ¥åœ°å€ | `sichuan.url` | `http://59.225.208.12:18085/access/data/report` |
| å››å· | APIå¯†é’¥ | `sichuan.apiKey` | `AK-9lKIK7RZrHxPsxq9eYzb2BWBCq8WeSwIPC2e` |
| å››å· | SM2å…¬é’¥ | `sichuan.sm2PublicKey` | ï¼ˆå¯é€‰ï¼‰ |
| å±±ä¸œ | TCPæœåŠ¡å™¨ | `shandong.host` | `192.168.1.100` |
| å±±ä¸œ | TCPç«¯å£ | `shandong.port` | `8080` |
| å±±ä¸œ | è®¿é—®å¯†ç  | `shandong.password` | `123456` |

---

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡

### é¡µé¢1ï¼šç”¨æˆ· - è®¾å¤‡ç®¡ç†ï¼ˆå«ä¸ŠæŠ¥é…ç½®ï¼‰

**è·¯å¾„**ï¼š`/devices`
**æƒé™**ï¼šç”¨æˆ·å¯è®¿é—®è‡ªå·±å…¬å¸çš„è®¾å¤‡

#### è®¾å¤‡åˆ—è¡¨è¡¨æ ¼

```vue
<el-table :data="devices">
  <el-table-column prop="deviceCode" label="è®¾å¤‡ç¼–ç " width="120" />
  <el-table-column prop="deviceName" label="è®¾å¤‡åç§°" width="150" />
  <el-table-column prop="deviceType" label="ç±»å‹" width="100">
    <template #default="{ row }">
      <el-tag :type="row.deviceType === 'RADIATION_MONITOR' ? 'danger' : 'success'">
        {{ row.deviceType === 'RADIATION_MONITOR' ? 'è¾å°„' : 'ç¯å¢ƒ' }}
      </el-tag>
    </template>
  </el-table-column>

  <!-- ä¸ŠæŠ¥çŠ¶æ€ -->
  <el-table-column label="ä¸ŠæŠ¥çŠ¶æ€" width="80">
    <template #default="{ row }">
      <el-switch
        v-model="row.dataReportEnabled"
        @change="handleToggleReport(row)"
        :loading="row.updating"
      />
    </template>
  </el-table-column>

  <el-table-column prop="reportProtocol" label="åè®®" width="80">
    <template #default="{ row }">
      <el-tag size="small">
        {{ row.reportProtocol === 'SICHUAN' ? 'å››å·' : 'å±±ä¸œ' }}
      </el-tag>
    </template>
  </el-table-column>

  <el-table-column prop="lastReportTime" label="æœ€åä¸ŠæŠ¥" width="140">
    <template #default="{ row }">
      {{ formatTime(row.lastReportTime) || 'æœªä¸ŠæŠ¥' }}
    </template>
  </el-table-column>

  <el-table-column label="æˆåŠŸç‡" width="100">
    <template #default="{ row }">
      <el-progress
        :percentage="calculateSuccessRate(row)"
        :color="getSuccessRateColor(calculateSuccessRate(row))"
        :stroke-width="8"
      />
    </template>
  </el-table-column>

  <el-table-column label="æ“ä½œ" width="180" fixed="right">
    <template #default="{ row }">
      <el-button size="small" type="primary" @click="handleConfig(row)">
        é…ç½®ä¸ŠæŠ¥
      </el-button>
      <el-button size="small" @click="handleViewLog(row)">
        æ—¥å¿—
      </el-button>
    </template>
  </el-table-column>
</el-table>
```

---

### é¡µé¢2ï¼šç”¨æˆ· - è®¾å¤‡ä¸ŠæŠ¥é…ç½®å¯¹è¯æ¡†

**è§¦å‘**ï¼šç‚¹å‡»"é…ç½®ä¸ŠæŠ¥"æŒ‰é’®
**ç»„ä»¶**ï¼š`DeviceReportConfigDialog.vue`

```vue
<el-dialog
  v-model="visible"
  :title="`é…ç½®ä¸ŠæŠ¥ - ${device.deviceName}`"
  width="700px"
>
  <el-form :model="form" :rules="rules" ref="formRef" label-width="140px">

    <!-- ====== åŸºç¡€é…ç½® ====== -->
    <el-divider content-position="left">åŸºç¡€é…ç½®</el-divider>

    <el-form-item label="å¯ç”¨æ•°æ®ä¸ŠæŠ¥">
      <el-switch v-model="form.dataReportEnabled" />
      <span class="ml-2 text-gray-500 text-sm">
        å¼€å¯åå°†è‡ªåŠ¨ä¸ŠæŠ¥æ•°æ®åˆ°ç›‘ç®¡å¹³å°
      </span>
    </el-form-item>

    <el-form-item label="ä¸ŠæŠ¥åè®®">
      <el-radio-group
        v-model="form.reportProtocol"
        :disabled="!form.dataReportEnabled"
        @change="handleProtocolChange"
      >
        <el-radio value="SICHUAN" border>
          <div class="protocol-option">
            <div class="protocol-title">å››å·åè®®</div>
            <div class="protocol-desc">HTTP + SM2åŠ å¯†</div>
            <div class="protocol-req">éœ€é…ç½®ï¼šæ ¸ç´ ç±»å‹</div>
          </div>
        </el-radio>
        <el-radio value="SHANDONG" border>
          <div class="protocol-option">
            <div class="protocol-title">å±±ä¸œåè®®</div>
            <div class="protocol-desc">TCP + HJ/T212-2005</div>
            <div class="protocol-req">éœ€é…ç½®ï¼šæ”¾å°„æºä¿¡æ¯ï¼ˆ7é¡¹ï¼‰</div>
          </div>
        </el-radio>
      </el-radio-group>
    </el-form-item>

    <!-- GPSè¯´æ˜ -->
    <el-alert
      type="info"
      :closable="false"
      show-icon
      class="mb-4"
    >
      <template #title>ğŸ“ GPSè‡ªåŠ¨é€‰æ‹©</template>
      <p class="mb-2">ç³»ç»Ÿä¼šæ ¹æ®è®¾å¤‡ä¸ŠæŠ¥æ•°æ®è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜GPSï¼š</p>
      <ul class="ml-4 mb-0">
        <li>åŒ—æ–—GPSå¯ç”¨ï¼ˆuseful=1ï¼‰â†’ ä½¿ç”¨åŒ—æ–—</li>
        <li>åŒ—æ–—ä¸å¯ç”¨ â†’ ä½¿ç”¨åŸºç«™GPS</li>
      </ul>
    </el-alert>

    <!-- ====== è¾å°„è®¾å¤‡ä¸“ç”¨é…ç½® ====== -->
    <div v-if="device.deviceType === 'RADIATION_MONITOR' && form.dataReportEnabled">
      <el-divider content-position="left">
        è¾å°„è®¾å¤‡é…ç½®
      </el-divider>

      <!-- å››å·åè®®å­—æ®µ -->
      <template v-if="form.reportProtocol === 'SICHUAN'">
        <el-form-item label="æ ¸ç´ ç±»å‹" prop="nuclide">
          <el-input
            v-model="form.nuclide"
            placeholder="å¦‚ï¼šCs-137ã€Co-60"
            clearable
          >
            <template #prefix>ğŸ§ª</template>
          </el-input>
          <div class="text-gray text-sm mt-1">
            ç¤ºä¾‹ï¼šCs-137ã€Co-60ã€I-125
          </div>
        </el-form-item>
      </template>

      <!-- å±±ä¸œåè®®å­—æ®µ -->
      <template v-if="form.reportProtocol === 'SHANDONG'">
        <el-form-item label="æ¢ä¼¤æœºç¼–å·" prop="inspectionMachineNumber">
          <el-input
            v-model="form.inspectionMachineNumber"
            placeholder="6ä½æ•°å­—"
            maxlength="6"
            clearable
          >
            <template #prefix>ğŸ”§</template>
          </el-input>
        </el-form-item>

        <el-form-item label="æ”¾å°„æºç¼–å·" prop="sourceNumber">
          <el-input
            v-model="form.sourceNumber"
            placeholder="12ä½æ•°å­—"
            maxlength="12"
            clearable
          >
            <template #prefix>â˜¢ï¸</template>
          </el-input>
        </el-form-item>

        <el-form-item label="æ”¾å°„æºç±»åˆ«" prop="sourceType">
          <el-select v-model="form.sourceType" placeholder="è¯·é€‰æ‹©" style="width: 100%">
            <el-option label="â… ç±»" value="01" />
            <el-option label="â…¡ç±»" value="02" />
            <el-option label="â…¢ç±»" value="03" />
            <el-option label="â…£ç±»" value="04" />
            <el-option label="â…¤ç±»" value="05" />
          </el-select>
        </el-form-item>

        <el-form-item label="åŸå§‹æ´»åº¦" prop="originalActivity">
          <el-input
            v-model="form.originalActivity"
            placeholder="å¦‚ï¼š2.700E004"
            clearable
          >
            <template #prefix>ğŸ“Š</template>
          </el-input>
          <div class="text-gray text-sm mt-1">
            ç§‘å­¦è®¡æ•°æ³•æ ¼å¼ï¼Œå¦‚ï¼š2.700E004
          </div>
        </el-form-item>

        <el-form-item label="å½“å‰æ´»åº¦" prop="currentActivity">
          <el-input
            v-model="form.currentActivity"
            placeholder="å¦‚ï¼š1.300E004"
            clearable
          >
            <template #prefix>ğŸ“ˆ</template>
          </el-input>
        </el-form-item>

        <el-form-item label="å‡ºå‚æ—¥æœŸ" prop="sourceProductionDate">
          <el-date-picker
            v-model="form.sourceProductionDate"
            type="date"
            placeholder="é€‰æ‹©æ—¥æœŸ"
            format="YYYY-MM-DD"
            value-format="YYYY-MM-DD"
            style="width: 100%"
          />
        </el-form-item>
      </template>
    </div>

    <!-- ç¯å¢ƒè®¾å¤‡æç¤º -->
    <div v-if="device.deviceType === 'ENVIRONMENT_STATION' && form.dataReportEnabled">
      <el-alert type="success" :closable="false" show-icon>
        ç¯å¢ƒè®¾å¤‡æ— éœ€é…ç½®é¢å¤–å‚æ•°
      </el-alert>
    </div>

  </el-form>

  <template #footer>
    <div class="dialog-footer">
      <el-button @click="visible = false">å–æ¶ˆ</el-button>
      <el-button type="primary" @click="handleSubmit" :loading="submitting">
        ä¿å­˜é…ç½®
      </el-button>
    </div>
  </template>
</el-dialog>
```

#### è¡¨å•éªŒè¯è§„åˆ™

```javascript
const rules = computed(() => {
  const baseRules = {
    dataReportEnabled: [{ type: 'boolean', required: true }],
    reportProtocol: [{ required: true, message: 'è¯·é€‰æ‹©ä¸ŠæŠ¥åè®®' }]
  }

  // å››å·åè®®éªŒè¯
  if (form.value.reportProtocol === 'SICHUAN' && form.value.dataReportEnabled) {
    return {
      ...baseRules,
      nuclide: [
        { required: true, message: 'è¯·è¾“å…¥æ ¸ç´ ç±»å‹' }
      ]
    }
  }

  // å±±ä¸œåè®®éªŒè¯
  if (form.value.reportProtocol === 'SHANDONG' && form.value.dataReportEnabled) {
    return {
      ...baseRules,
      inspectionMachineNumber: [
        { required: true, message: 'è¯·è¾“å…¥æ¢ä¼¤æœºç¼–å·' },
        { pattern: /^\d{6}$/, message: 'å¿…é¡»ä¸º6ä½æ•°å­—' }
      ],
      sourceNumber: [
        { required: true, message: 'è¯·è¾“å…¥æ”¾å°„æºç¼–å·' },
        { pattern: /^\d{12}$/, message: 'å¿…é¡»ä¸º12ä½æ•°å­—' }
      ],
      sourceType: [
        { required: true, message: 'è¯·é€‰æ‹©æ”¾å°„æºç±»åˆ«' }
      ],
      originalActivity: [
        { required: true, message: 'è¯·è¾“å…¥åŸå§‹æ´»åº¦' },
        { pattern: /^\d+\.\d+E[+-]?\d+$/, message: 'ç§‘å­¦è®¡æ•°æ³•æ ¼å¼ï¼Œå¦‚2.700E004' }
      ],
      currentActivity: [
        { required: true, message: 'è¯·è¾“å…¥å½“å‰æ´»åº¦' },
        { pattern: /^\d+\.\d+E[+-]?\d+$/, message: 'ç§‘å­¦è®¡æ•°æ³•æ ¼å¼ï¼Œå¦‚1.300E004' }
      ],
      sourceProductionDate: [
        { required: true, message: 'è¯·é€‰æ‹©å‡ºå‚æ—¥æœŸ' }
      ]
    }
  }

  return baseRules
})
```

---

### é¡µé¢3ï¼šä¸ŠæŠ¥æ—¥å¿—ï¼ˆç®€åŒ–ç‰ˆï¼‰

**è·¯å¾„**ï¼š`/devices/:id/report-logs`
**ç»„ä»¶**ï¼š`DeviceReportLogList.vue`

#### æ—¥å¿—åˆ—è¡¨

```vue
<el-table :data="logs" v-loading="loading">
  <el-table-column prop="reportTime" label="ä¸ŠæŠ¥æ—¶é—´" width="160">
    <template #default="{ row }">
      {{ formatTime(row.reportTime) }}
    </template>
  </el-table-column>

  <el-table-column prop="reportProtocol" label="åè®®" width="80">
    <template #default="{ row }">
      <el-tag size="small" :type="row.reportProtocol === 'SICHUAN' ? 'primary' : 'success'">
        {{ row.reportProtocol === 'SICHUAN' ? 'å››å·' : 'å±±ä¸œ' }}
      </el-tag>
    </template>
  </el-table-column>

  <el-table-column prop="status" label="çŠ¶æ€" width="80">
    <template #default="{ row }">
      <el-tag :type="row.status === 'SUCCESS' ? 'success' : 'danger'" size="small">
        {{ row.status === 'SUCCESS' ? 'æˆåŠŸ' : 'å¤±è´¥' }}
      </el-tag>
    </template>
  </el-table-column>

  <el-table-column prop="duration" label="è€—æ—¶" width="80">
    <template #default="{ row }">
      {{ row.duration }}ms
    </template>
  </el-table-column>

  <el-table-column label="æ“ä½œ" width="100">
    <template #default="{ row }">
      <el-button
        size="small"
        type="primary"
        link
        @click="handleViewDetail(row)"
        v-if="row.status === 'FAILED'"
      >
        æŸ¥çœ‹é”™è¯¯
      </el-button>
      <span v-else class="text-gray">-</span>
    </template>
  </el-table-column>
</el-table>

<!-- é”™è¯¯è¯¦æƒ…å¯¹è¯æ¡† -->
<el-dialog v-model="errorDialogVisible" title="é”™è¯¯è¯¦æƒ…" width="600">
  <el-descriptions :column="1" border>
    <el-descriptions-item label="ä¸ŠæŠ¥æ—¶é—´">
      {{ currentLog.reportTime }}
    </el-descriptions-item>
    <el-descriptions-item label="åè®®">
      {{ currentLog.reportProtocol === 'SICHUAN' ? 'å››å·åè®®' : 'å±±ä¸œåè®®' }}
    </el-descriptions-item>
    <el-descriptions-item label="é”™è¯¯ä¿¡æ¯">
      <el-text type="danger" tag="pre">{{ currentLog.errorMessage }}</el-text>
    </el-descriptions-item>
    <el-descriptions-item label="è¯·æ±‚å†…å®¹" v-if="currentLog.requestPayload">
      <el-text tag="pre" class="pre-wrap">{{ formatJson(currentLog.requestPayload) }}</el-text>
    </el-descriptions-item>
    <el-descriptions-item label="å“åº”å†…å®¹" v-if="currentLog.responseBody">
      <el-text tag="pre" class="pre-wrap">{{ formatJson(currentLog.responseBody) }}</el-text>
    </el-descriptions-item>
  </el-descriptions>
</el-dialog>
```

---

### é¡µé¢4ï¼šç®¡ç†å‘˜ - ç³»ç»Ÿé…ç½®ï¼ˆæ–°å¢ï¼‰

**è·¯å¾„**ï¼š`/admin/system/report-config`
**æƒé™**ï¼šä»…ç®¡ç†å‘˜
**ç»„ä»¶**ï¼š`SystemReportConfig.vue`

```vue
<el-tabs v-model="activeTab">
  <!-- å››å·åè®®é…ç½® -->
  <el-tab-pane label="å››å·åè®®" name="sichuan">
    <el-form :model="sichuanConfig" label-width="140px">
      <el-form-item label="ä¸ŠæŠ¥åœ°å€">
        <el-input v-model="sichuanConfig.url" placeholder="http://..." />
      </el-form-item>

      <el-form-item label="APIå¯†é’¥">
        <el-input v-model="sichuanConfig.apiKey" type="password" show-password />
      </el-form-item>

      <el-form-item label="SM2å…¬é’¥">
        <el-input
          v-model="sichuanConfig.sm2PublicKey"
          type="textarea"
          :rows="4"
          placeholder="ï¼ˆå¯é€‰ï¼‰ç”¨äºæ•°æ®åŠ å¯†"
        />
      </el-form-item>

      <el-form-item label="è¿æ¥è¶…æ—¶">
        <el-input-number v-model="sichuanConfig.connectTimeout" :min="1000" :max="60000" />
        <span class="ml-2">æ¯«ç§’</span>
      </el-form-item>

      <el-form-item label="è¯»å–è¶…æ—¶">
        <el-input-number v-model="sichuanConfig.readTimeout" :min="1000" :max="60000" />
        <span class="ml-2">æ¯«ç§’</span>
      </el-form-item>

      <el-form-item>
        <el-button type="primary" @click="handleSaveSichuan">ä¿å­˜é…ç½®</el-button>
        <el-button @click="handleTestSichuan">æµ‹è¯•è¿æ¥</el-button>
      </el-form-item>
    </el-form>
  </el-tab-pane>

  <!-- å±±ä¸œåè®®é…ç½® -->
  <el-tab-pane label="å±±ä¸œåè®®" name="shandong">
    <el-form :model="shandongConfig" label-width="140px">
      <el-form-item label="TCPæœåŠ¡å™¨">
        <el-input v-model="shandongConfig.host" placeholder="192.168.1.100" />
      </el-form-item>

      <el-form-item label="TCPç«¯å£">
        <el-input-number v-model="shandongConfig.port" :min="1" :max="65535" />
      </el-form-item>

      <el-form-item label="è®¿é—®å¯†ç ">
        <el-input v-model="shandongConfig.password" type="password" show-password />
      </el-form-item>

      <el-form-item label="è¿æ¥è¶…æ—¶">
        <el-input-number v-model="shandongConfig.connectTimeout" :min="1000" :max="60000" />
        <span class="ml-2">æ¯«ç§’</span>
      </el-form-item>

      <el-form-item>
        <el-button type="primary" @click="handleSaveShandong">ä¿å­˜é…ç½®</el-button>
        <el-button @click="handleTestShandong">æµ‹è¯•è¿æ¥</el-button>
      </el-form-item>
    </el-form>
  </el-tab-pane>
</el-tabs>
```

---

## ğŸ”Œ APIæ¥å£è®¾è®¡

### 1. è®¾å¤‡ä¸ŠæŠ¥é…ç½®ï¼ˆç”¨æˆ·å¯æ“ä½œï¼‰

```javascript
// æ›´æ–°è®¾å¤‡ï¼ˆå·²æœ‰æ¥å£ï¼Œæ‰©å±•æ”¯æŒä¸ŠæŠ¥é…ç½®ï¼‰
PUT /api/devices/{id}

Request:
{
  "deviceName": "è®¾å¤‡åç§°",
  "location": "ä½ç½®",

  // ä¸ŠæŠ¥é…ç½®
  "dataReportEnabled": true,
  "reportProtocol": "SICHUAN",

  // è¾å°„è®¾å¤‡ä¸“ç”¨ï¼ˆæ ¹æ®åè®®ç±»å‹ä¼ å‚ï¼‰
  "nuclide": "Cs-137",              // å››å·åè®®
  "inspectionMachineNumber": "123456",  // å±±ä¸œåè®®
  "sourceNumber": "123456789012",
  "sourceType": "01",
  "originalActivity": "2.700E004",
  "currentActivity": "1.300E004",
  "sourceProductionDate": "2022-01-01"
}

Response:
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ",
  "data": { /* DeviceResponse */ }
}
```

### 2. ä¸ŠæŠ¥æ—¥å¿—æŸ¥è¯¢ï¼ˆç”¨æˆ·å¯æ“ä½œï¼‰

```javascript
// è·å–è®¾å¤‡ä¸ŠæŠ¥æ—¥å¿—
GET /api/devices/{deviceId}/report-logs?page=0&size=20

Response:
{
  "code": 200,
  "data": {
    "content": [
      {
        "id": 1,
        "reportTime": "2025-12-29 10:00:00",
        "reportProtocol": "SICHUAN",
        "status": "SUCCESS",
        "duration": 523,
        "errorMessage": null,
        "requestPayload": "{...}",
        "responseBody": "{...}"
      }
    ],
    "totalElements": 100,
    "totalPages": 5
  }
}
```

### 3. ç³»ç»Ÿçº§é…ç½®ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

```javascript
// è·å–ç³»ç»Ÿä¸ŠæŠ¥é…ç½®
GET /api/admin/system/report-config

Response:
{
  "code": 200,
  "data": {
    "sichuan": {
      "url": "http://59.225.208.12:18085/access/data/report",
      "apiKey": "AK-xxxx",
      "sm2PublicKey": "...",
      "connectTimeout": 5000,
      "readTimeout": 10000
    },
    "shandong": {
      "host": "192.168.1.100",
      "port": 8080,
      "password": "123456",
      "connectTimeout": 5000
    }
  }
}

// æ›´æ–°ç³»ç»Ÿä¸ŠæŠ¥é…ç½®
PUT /api/admin/system/report-config

Request:
{
  "sichuan": { /* å››å·åè®®é…ç½® */ },
  "shandong": { /* å±±ä¸œåè®®é…ç½® */ }
}
```

---

## ğŸ“± ç”¨æˆ·æ“ä½œæµç¨‹

### åœºæ™¯1ï¼šç”¨æˆ·é…ç½®æ–°è®¾å¤‡çš„ä¸ŠæŠ¥åŠŸèƒ½

```
1. ç”¨æˆ·è¿›å…¥"è®¾å¤‡ç®¡ç†"
2. æ‰¾åˆ°è¦é…ç½®çš„è®¾å¤‡
3. ç‚¹å‡»"é…ç½®ä¸ŠæŠ¥"æŒ‰é’®
4. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼š
   a. æ‰“å¼€"å¯ç”¨æ•°æ®ä¸ŠæŠ¥"å¼€å…³
   b. é€‰æ‹©ä¸ŠæŠ¥åè®®ï¼ˆå››å·/å±±ä¸œï¼‰
   c. æ ¹æ®åè®®å¡«å†™ç›¸åº”å­—æ®µ
   d. ç‚¹å‡»"ä¿å­˜é…ç½®"
5. ç³»ç»Ÿå¼€å§‹è‡ªåŠ¨ä¸ŠæŠ¥æ•°æ®
```

### åœºæ™¯2ï¼šç”¨æˆ·æŸ¥çœ‹ä¸ŠæŠ¥æ—¥å¿—

```
1. ç”¨æˆ·è¿›å…¥"è®¾å¤‡ç®¡ç†"
2. æ‰¾åˆ°è®¾å¤‡ï¼Œç‚¹å‡»"æ—¥å¿—"æŒ‰é’®
3. æŸ¥çœ‹ä¸ŠæŠ¥å†å²è®°å½•ï¼š
   - æˆåŠŸ/å¤±è´¥çŠ¶æ€
   - ä¸ŠæŠ¥è€—æ—¶
   - å¤±è´¥æ—¶ç‚¹å‡»"æŸ¥çœ‹é”™è¯¯"
4. å¯ä»¥ç­›é€‰æ¡ä»¶ï¼šæ—¶é—´èŒƒå›´ã€çŠ¶æ€ã€åè®®
```

### åœºæ™¯3ï¼šç®¡ç†å‘˜é…ç½®ç³»ç»Ÿå‚æ•°

```
1. ç®¡ç†å‘˜è¿›å…¥"ç³»ç»Ÿè®¾ç½®"
2. æ‰¾åˆ°"ä¸ŠæŠ¥é…ç½®"é€‰é¡¹
3. é…ç½®æœåŠ¡å™¨åœ°å€ã€å¯†é’¥ç­‰å‚æ•°
4. æµ‹è¯•è¿æ¥
5. ä¿å­˜é…ç½®
```

---

## ğŸ¯ é…ç½®é¡¹æ€»ç»“è¡¨

| é…ç½®é¡¹ | ç”¨æˆ·å¯é…ç½® | ç®¡ç†å‘˜å¯é…ç½® | è¯´æ˜ |
|--------|-----------|-------------|------|
| è®¾å¤‡ä¸ŠæŠ¥å¼€å…³ | âœ… è‡ªå·±çš„è®¾å¤‡ | âœ… æ‰€æœ‰è®¾å¤‡ | ç”¨æˆ·ä¸»è¦é…ç½® |
| ä¸ŠæŠ¥åè®®é€‰æ‹© | âœ… | âœ… | ç”¨æˆ·ä¸»è¦é…ç½® |
| æ ¸ç´ ç±»å‹ | âœ… | âœ… | è¾å°„è®¾å¤‡-å››å· |
| æ¢ä¼¤æœºç¼–å· | âœ… | âœ… | è¾å°„è®¾å¤‡-å±±ä¸œ |
| æ”¾å°„æºç¼–å· | âœ… | âœ… | è¾å°„è®¾å¤‡-å±±ä¸œ |
| æ”¾å°„æºç±»åˆ« | âœ… | âœ… | è¾å°„è®¾å¤‡-å±±ä¸œ |
| åŸå§‹æ´»åº¦ | âœ… | âœ… | è¾å°„è®¾å¤‡-å±±ä¸œ |
| å½“å‰æ´»åº¦ | âœ… | âœ… | è¾å°„è®¾å¤‡-å±±ä¸œ |
| å‡ºå‚æ—¥æœŸ | âœ… | âœ… | è¾å°„è®¾å¤‡-å±±ä¸œ |
| ä¸ŠæŠ¥æ—¥å¿— | âœ… æŸ¥çœ‹ | âœ… æŸ¥çœ‹ | ç®€åŒ–ç‰ˆæ—¥å¿— |
| ç³»ç»Ÿå‚æ•° | âŒ | âœ… | æœåŠ¡å™¨åœ°å€ã€å¯†é’¥ç­‰ |

---

## ğŸš¨ å…³é”®æ³¨æ„äº‹é¡¹

### 1. GPSå·²è‡ªåŠ¨é€‰æ‹©ï¼Œæ— éœ€é…ç½®

**é‡è¦**ï¼šå‰ç«¯ç•Œé¢å¿…é¡»è¯´æ˜GPSæ˜¯è‡ªåŠ¨é€‰æ‹©çš„

```vue
<el-alert type="info" show-icon>
  <p>ğŸ“ <strong>GPSè‡ªåŠ¨é€‰æ‹©</strong></p>
  <p>ç³»ç»Ÿæ ¹æ®è®¾å¤‡ä¸ŠæŠ¥æ•°æ®è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜GPSï¼š</p>
  <ul>
    <li>åŒ—æ–—GPSå¯ç”¨ï¼ˆuseful=1ï¼‰â†’ ä½¿ç”¨åŒ—æ–—</li>
    <li>åŒ—æ–—ä¸å¯ç”¨ â†’ ä½¿ç”¨åŸºç«™GPS</li>
  </ul>
</el-alert>
```

### 2. åè®®åˆ‡æ¢æ—¶å­—æ®µå¤„ç†

```javascript
const handleProtocolChange = (newProtocol) => {
  if (newProtocol === 'SICHUAN') {
    // è®¾ç½®é»˜è®¤å€¼
    form.nuclide = form.nuclide || 'Cs-137'
    // æ¸…ç©ºå±±ä¸œåè®®å­—æ®µ
    form.inspectionMachineNumber = null
    form.sourceNumber = null
    form.sourceType = null
    form.originalActivity = null
    form.currentActivity = null
    form.sourceProductionDate = null
  } else if (newProtocol === 'SHANDONG') {
    // è®¾ç½®é»˜è®¤å€¼
    form.sourceType = form.sourceType || '01'
    // æ¸…ç©ºå››å·åè®®å­—æ®µ
    form.nuclide = null
  }
}
```

### 3. ç¯å¢ƒè®¾å¤‡é…ç½®ç®€å•

**ç¯å¢ƒè®¾å¤‡**åªéœ€è¦é…ç½®åŸºç¡€å‚æ•°ï¼Œæ— éœ€ä¸“ç”¨å­—æ®µã€‚

ç•Œé¢æ˜¾ç¤ºæç¤ºï¼š
```vue
<el-alert type="success" show-icon v-if="deviceType === 'ENVIRONMENT_STATION'">
  ç¯å¢ƒè®¾å¤‡ä»…éœ€é…ç½®åŸºç¡€ä¸ŠæŠ¥å‚æ•°ï¼Œæ— éœ€å…¶ä»–é…ç½®
</el-alert>
```

---

## ğŸ“Š ä¸ŠæŠ¥æ—¥å¿—ç®€åŒ–è®¾è®¡

### æ—¥å¿—å®ä½“ï¼ˆç®€åŒ–ç‰ˆï¼‰

```java
@Data
@Entity
@Table(name = "ems_data_report_log")
public class DataReportLog {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "device_id")
    private Long deviceId;

    @Column(name = "device_code")
    private String deviceCode;

    @Column(name = "report_protocol")
    private String reportProtocol;  // SICHUAN/SHANDONG

    @Column(name = "report_time")
    private LocalDateTime reportTime;

    @Column(name = "status")
    private String status;  // SUCCESS/FAILED

    @Column(name = "duration_ms")
    private Long durationMs;  // è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰

    @Column(name = "error_message", columnDefinition = "TEXT")
    private String errorMessage;

    @Column(name = "request_payload", columnDefinition = "TEXT")
    private String requestPayload;  // ä»…å¤±è´¥æ—¶ä¿ç•™

    @Column(name = "response_body", columnDefinition = "TEXT")
    private String responseBody;    // ä»…å¤±è´¥æ—¶ä¿ç•™
}
```

### æ—¥å¿—åˆ—è¡¨æ˜¾ç¤ºå­—æ®µ

- ä¸ŠæŠ¥æ—¶é—´
- åè®®ç±»å‹
- çŠ¶æ€ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
- è€—æ—¶
- æ“ä½œï¼ˆæŸ¥çœ‹é”™è¯¯ï¼‰

**ç®€åŒ–ç‚¹**ï¼š
- âŒ ä¸æ˜¾ç¤ºHTTPçŠ¶æ€ç ï¼ˆæŠ€æœ¯ç»†èŠ‚ï¼‰
- âŒ ä¸æ˜¾ç¤ºå®Œæ•´è¯·æ±‚/å“åº”ï¼ˆæˆåŠŸæ—¶ï¼‰
- âœ… ä»…å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å’Œè¯·æ±‚å†…å®¹
- âœ… ä¿ç•™å¿…è¦ä¿¡æ¯ç”¨äºè°ƒè¯•

---

## âœ… å®æ–½æ£€æŸ¥æ¸…å•

### å‰ç«¯å¼€å‘

- [ ] åˆ›å»º `DeviceReportConfigDialog.vue` ç»„ä»¶
- [ ] æ›´æ–° `DeviceList.vue` æ·»åŠ "é…ç½®ä¸ŠæŠ¥"æŒ‰é’®
- [ ] åˆ›å»º `DeviceReportLogList.vue` ç»„ä»¶
- [ ] åˆ›å»º `SystemReportConfig.vue`ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
- [ ] æ·»åŠ GPSè‡ªåŠ¨é€‰æ‹©è¯´æ˜
- [ ] å®ç°åè®®åˆ‡æ¢é€»è¾‘
- [ ] æ·»åŠ è¡¨å•éªŒè¯è§„åˆ™
- [ ] æ·»åŠ æˆåŠŸ/å¤±è´¥çŠ¶æ€æ ·å¼

### åç«¯å¼€å‘

- [ ] å®ç°ä¸ŠæŠ¥æ—¥å¿—æŸ¥è¯¢æ¥å£
- [ ] å®ç°ç³»ç»Ÿé…ç½®æ¥å£ï¼ˆç®¡ç†å‘˜ï¼‰
- [ ] ç¡®è®¤æƒé™æ§åˆ¶æ­£ç¡®
- [ ] æµ‹è¯•æ—¥å¿—æŸ¥è¯¢æ€§èƒ½

### æµ‹è¯•éªŒè¯

- [ ] ç”¨æˆ·é…ç½®è¾å°„è®¾å¤‡ï¼ˆå››å·åè®®ï¼‰
- [ ] ç”¨æˆ·é…ç½®è¾å°„è®¾å¤‡ï¼ˆå±±ä¸œåè®®ï¼‰
- [ ] ç”¨æˆ·é…ç½®ç¯å¢ƒè®¾å¤‡
- [ ] ç”¨æˆ·æŸ¥çœ‹ä¸ŠæŠ¥æ—¥å¿—
- [ ] ç®¡ç†å‘˜é…ç½®ç³»ç»Ÿå‚æ•°
- [ ] æƒé™æ§åˆ¶æµ‹è¯•

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GPSæ•°æ®å¤„ç†ä¼˜åŒ–æ–¹æ¡ˆ.md](./GPSæ•°æ®å¤„ç†ä¼˜åŒ–æ–¹æ¡ˆ.md)
- [æ•°æ®ä¸ŠæŠ¥æ¨¡å—è®¾è®¡æ–¹æ¡ˆV3-æç®€ç‰ˆ.md](./æ•°æ®ä¸ŠæŠ¥æ¨¡å—è®¾è®¡æ–¹æ¡ˆV3-æç®€ç‰ˆ.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š2.0
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-29
**æœ€åæ›´æ–°**ï¼š2025-12-29
**ä½œè€…**ï¼šClaude Code
**çŠ¶æ€**ï¼šâœ… å¾…å®æ–½

**ä¸»è¦å˜æ›´**ï¼š
- âœ… ä¿®æ­£æƒé™è®¾è®¡ï¼šç”¨æˆ·å¯é…ç½®è‡ªå·±è®¾å¤‡çš„ä¸ŠæŠ¥å‚æ•°
- âœ… æ–°å¢ç³»ç»Ÿçº§é…ç½®ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
- âœ… ç®€åŒ–ä¸ŠæŠ¥æ—¥å¿—è®¾è®¡
- âœ… æ˜ç¡®ç”¨æˆ·ä¸ºé…ç½®ä¸»ä½“
