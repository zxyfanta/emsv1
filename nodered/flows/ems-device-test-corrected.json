[
    {
        "id": "ems-device-test-corrected",
        "type": "tab",
        "label": "EMSè®¾å¤‡æµ‹è¯• - ä¿®æ­£ç‰ˆæœ¬",
        "disabled": false,
        "info": "EMSè®¾å¤‡æ¨¡æ‹Ÿå™¨ - åŸºäºNode-RED 4.1.1æ­£ç¡®é…ç½®çš„æµ‹è¯•æµ"
    },
    {
        "id": "mqtt-config-mosquitto",
        "type": "mqtt-broker",
        "name": "Mosquitto-Broker",
        "broker": "mosquitto",
        "port": "1883",
        "clientid": "ems-device-tester",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "username": "",
        "password": ""
    },
    {
        "id": "inject-rad-001",
        "type": "inject",
        "z": "ems-device-test-corrected",
        "name": "RAD-001å·²æ³¨å†Œ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": true,
        "onceDelay": 2,
        "topic": "ems/device/RAD-001/data/RADIATION",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 80,
        "wires": [
            [
                "function-rad-001"
            ]
        ]
    },
    {
        "id": "function-rad-001",
        "type": "function",
        "z": "ems-device-test-corrected",
        "name": "ç”ŸæˆRAD-001æ•°æ®",
        "func": "// ç”ŸæˆRAD-001å·²æ³¨å†Œè¾å°„è®¾å¤‡æ•°æ®\nconst deviceId = 'RAD-001';\nconst timestamp = new Date(msg.payload);\nconst timeStr = timestamp.toISOString().replace('T', ' ').substring(0, 19);\n\n// æ¨¡æ‹ŸçœŸå®çš„è¾å°„æ•°æ®å˜åŒ–\nconst baseCPM = 35;\nconst cpmVariation = Math.sin(Date.now() / 60000) * 15;\nconst cpm = Math.floor(baseCPM + cpmVariation + (Math.random() - 0.5) * 10);\n\n// æ¨¡æ‹Ÿç”µæ± ç”µé‡ç¼“æ…¢ä¸‹é™\nconst batteryBase = 4000;\nconst batteryDrain = (Date.now() % 86400000) / 86400000 * 200;\nconst battery = Math.floor(batteryBase - batteryDrain + (Math.random() - 0.5) * 50);\n\nconst data = {\n    BDS: {\n        longitude: \"11607.4321\",\n        latitude: \"3998.7654\",\n        useful: 1,\n        UTC: timeStr\n    },\n    CPM: Math.max(10, Math.min(100, cpm)),\n    Batvolt: Math.max(3500, Math.min(4200, battery)),\n    signal: Math.floor(Math.random() * 2) + 3,\n    temperature: Math.round((20 + Math.sin(Date.now() / 300000) * 5 + (Math.random() - 0.5) * 2) * 10) / 10,\n    time: timeStr\n};\n\nreturn {\n    topic: `ems/device/${deviceId}/data/RADIATION`,\n    payload: data,\n    deviceId: deviceId,\n    deviceType: 'RADIATION',\n    registered: true,\n    timestamp: timeStr\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 80,
        "wires": [
            [
                "mqtt-out",
                "debug-rad-001"
            ]
        ]
    },
    {
        "id": "inject-env-001",
        "type": "inject",
        "z": "ems-device-test-corrected",
        "name": "ENV-001å·²æ³¨å†Œ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "45",
        "crontab": "",
        "once": true,
        "onceDelay": 5,
        "topic": "ems/device/ENV-001/data/ENVIRONMENT",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 160,
        "wires": [
            [
                "function-env-001"
            ]
        ]
    },
    {
        "id": "function-env-001",
        "type": "function",
        "z": "ems-device-test-corrected",
        "name": "ç”ŸæˆENV-001æ•°æ®",
        "func": "// ç”ŸæˆENV-001å·²æ³¨å†Œç¯å¢ƒè®¾å¤‡æ•°æ®\nconst deviceId = 'ENV-001';\nconst timestamp = new Date(msg.payload);\nconst timeStr = timestamp.toISOString().replace('T', ' ').substring(0, 19);\nconst hour = timestamp.getHours();\n\n// æ¨¡æ‹Ÿç¯å¢ƒæ•°æ®å˜åŒ–\nconst baseTemp = 20;\nconst tempVariation = Math.sin((hour - 6) * Math.PI / 12) * 8;\nconst temperature = Math.round((baseTemp + tempVariation + (Math.random() - 0.5) * 3) * 10) / 10;\n\nconst baseHumidity = 60;\nconst humidityVariation = Math.cos((hour - 6) * Math.PI / 12) * 20;\nconst wetness = Math.round((baseHumidity + humidityVariation + (Math.random() - 0.5) * 10) * 10) / 10;\n\nconst windBase = 2 + Math.sin(Date.now() / 120000) * 1;\nconst windspeed = Math.round((windBase + (Math.random() - 0.5) * 2) * 10) / 10;\n\nconst data = {\n    src: 1,\n    CPM: Math.floor(Math.random() * 8) + 3,\n    temperature: Math.max(5, Math.min(40, temperature)),\n    wetness: Math.max(20, Math.min(90, wetness)),\n    windspeed: Math.max(0, Math.min(10, windspeed)),\n    total: Math.round((temperature * 2 + wetness * 0.5 + (100 - windspeed * 5)) * 10) / 10,\n    battery: Math.round((11.5 + (Math.random() - 0.5) * 1.5) * 10) / 10\n};\n\nreturn {\n    topic: `ems/device/${deviceId}/data/ENVIRONMENT`,\n    payload: data,\n    deviceId: deviceId,\n    deviceType: 'ENVIRONMENT',\n    registered: true,\n    timestamp: timeStr\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 160,
        "wires": [
            [
                "mqtt-out",
                "debug-env-001"
            ]
        ]
    },
    {
        "id": "inject-rad-999",
        "type": "inject",
        "z": "ems-device-test-corrected",
        "name": "RAD-999æœªæ³¨å†Œ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": true,
        "onceDelay": 8,
        "topic": "ems/device/RAD-999/data/RADIATION",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 240,
        "wires": [
            [
                "function-rad-999"
            ]
        ]
    },
    {
        "id": "function-rad-999",
        "type": "function",
        "z": "ems-device-test-corrected",
        "name": "ç”ŸæˆRAD-999æ•°æ®",
        "func": "// ç”ŸæˆRAD-999æœªæ³¨å†Œè¾å°„è®¾å¤‡æ•°æ®\nconst deviceId = 'RAD-999';\nconst timestamp = new Date(msg.payload);\nconst timeStr = timestamp.toISOString().replace('T', ' ').substring(0, 19);\n\n// æ¨¡æ‹Ÿæœªæ³¨å†Œè®¾å¤‡çš„è¾å°„æ•°æ®\nconst data = {\n    BDS: {\n        longitude: \"11699.9999\",\n        latitude: \"3999.9999\",\n        useful: 1,\n        UTC: timeStr\n    },\n    CPM: Math.floor(Math.random() * 80) + 50,\n    Batvolt: Math.floor(Math.random() * 500) + 3500,\n    signal: Math.floor(Math.random() * 3) + 2,\n    temperature: Math.round((Math.random() * 25 + 10) * 10) / 10,\n    time: timeStr\n};\n\nreturn {\n    topic: `ems/device/${deviceId}/data/RADIATION`,\n    payload: data,\n    deviceId: deviceId,\n    deviceType: 'RADIATION',\n    registered: false,\n    timestamp: timeStr\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 240,
        "wires": [
            [
                "mqtt-out",
                "debug-rad-999"
            ]
        ]
    },
    {
        "id": "inject-env-999",
        "type": "inject",
        "z": "ems-device-test-corrected",
        "name": "ENV-999æœªæ³¨å†Œ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "90",
        "crontab": "",
        "once": true,
        "onceDelay": 12,
        "topic": "ems/device/ENV-999/data/ENVIRONMENT",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 320,
        "wires": [
            [
                "function-env-999"
            ]
        ]
    },
    {
        "id": "function-env-999",
        "type": "function",
        "z": "ems-device-test-corrected",
        "name": "ç”ŸæˆENV-999æ•°æ®",
        "func": "// ç”ŸæˆENV-999æœªæ³¨å†Œç¯å¢ƒè®¾å¤‡æ•°æ®\nconst deviceId = 'ENV-999';\nconst timestamp = new Date(msg.payload);\nconst timeStr = timestamp.toISOString().replace('T', ' ').substring(0, 19);\n\n// æ¨¡æ‹Ÿæœªæ³¨å†Œè®¾å¤‡çš„ç¯å¢ƒæ•°æ®\nconst data = {\n    src: 1,\n    CPM: Math.floor(Math.random() * 15) + 10,\n    temperature: Math.round((Math.random() * 30 + 5) * 10) / 10,\n    wetness: Math.round((Math.random() * 40 + 30) * 10) / 10,\n    windspeed: Math.round((Math.random() * 5 + 0.5) * 10) / 10,\n    total: Math.round((Math.random() * 80 + 80) * 10) / 10,\n    battery: Math.round((Math.random() * 3 + 9) * 10) / 10\n};\n\nreturn {\n    topic: `ems/device/${deviceId}/data/ENVIRONMENT`,\n    payload: data,\n    deviceId: deviceId,\n    deviceType: 'ENVIRONMENT',\n    registered: false,\n    timestamp: timeStr\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 320,
        "wires": [
            [
                "mqtt-out",
                "debug-env-999"
            ]
        ]
    },
    {
        "id": "mqtt-out",
        "type": "mqtt out",
        "z": "ems-device-test-corrected",
        "name": "å‘é€åˆ°MQTT",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "mqtt-config-mosquitto",
        "x": 620,
        "y": 200,
        "wires": []
    },
    {
        "id": "debug-rad-001",
        "type": "debug",
        "z": "ems-device-test-corrected",
        "name": "RAD-001å·²æ³¨å†Œ",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 60,
        "wires": []
    },
    {
        "id": "debug-env-001",
        "type": "debug",
        "z": "ems-device-test-corrected",
        "name": "ENV-001å·²æ³¨å†Œ",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 140,
        "wires": []
    },
    {
        "id": "debug-rad-999",
        "type": "debug",
        "z": "ems-device-test-corrected",
        "name": "RAD-999æœªæ³¨å†Œ",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 220,
        "wires": []
    },
    {
        "id": "debug-env-999",
        "type": "debug",
        "z": "ems-device-test-corrected",
        "name": "ENV-999æœªæ³¨å†Œ",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 300,
        "wires": []
    },
    {
        "id": "comment-test-info",
        "type": "comment",
        "z": "ems-device-test-corrected",
        "name": "EMSè®¾å¤‡æµ‹è¯•åœºæ™¯\n\nâœ… å·²æ³¨å†Œè®¾å¤‡ (æ•°æ®æ­£å¸¸å¤„ç†):\n- RAD-001: è¾å°„è®¾å¤‡ï¼Œæ¯30ç§’\n- ENV-001: ç¯å¢ƒè®¾å¤‡ï¼Œæ¯45ç§’\n\nâŒ æœªæ³¨å†Œè®¾å¤‡ (æ•°æ®åº”è¢«æ‹’ç»):\n- RAD-999: è¾å°„è®¾å¤‡ï¼Œæ¯60ç§’\n- ENV-999: ç¯å¢ƒè®¾å¤‡ï¼Œæ¯90ç§’\n\nğŸ” éªŒè¯è¦ç‚¹:\n1. Node-REDè°ƒè¯•é¢æ¿æŸ¥çœ‹æ•°æ®æµ\n2. åç«¯æ—¥å¿—æŸ¥çœ‹è®¾å¤‡è®¤è¯ç»“æœ\n3. æ£€æŸ¥æ•°æ®åº“å­˜å‚¨æƒ…å†µ\n4. ç¡®è®¤Redisè®¾å¤‡æ³¨å†ŒçŠ¶æ€",
        "info": "",
        "x": 100,
        "y": 400,
        "wires": []
    }
]