# EMS企业级MQTT设备管理云平台 - 开发环境配置

spring:
  # 数据库配置（本地开发连接Docker容器）
  datasource:
    url: jdbc:mysql://localhost:3308/ems_db?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: ems_user
    password: ems_password
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      pool-name: EMSHikariCP-Dev
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 300000
      connection-timeout: 20000
      max-lifetime: 1200000
      leak-detection-threshold: 60000

  # JPA配置（开发环境）
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: true
        use_sql_comments: true
        jdbc:
          batch-size: 20
        order_inserts: true
        order_updates: true

  # Redis配置（本地开发连接Docker容器）
  data:
    redis:
      host: localhost
      port: 6380
      database: 0
      password:
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 8
          max-wait: -1ms
          max-idle: 8
          min-idle: 0

  
# 业务配置（开发环境）
ems:
  # MQTT配置（开发环境连接本地Docker容器）
  mqtt:
    host: localhost
    port: 1883
    client-id: ems-backend-dev
    username:
    password:
    topic-prefix: ems
    qos: 1
    clean-session: true
    auto-reconnect: true
    connection-timeout: 30
    keep-alive-interval: 60

  # JWT配置（开发环境）
  jwt:
    secret: ems-jwt-secret-key-for-enterprise-mqtt-system-2025-dev
    expiration: 86400000  # 24小时 (毫秒)
    refresh-expiration: 604800000  # 7天 (毫秒)

  # 文件上传配置
  file:
    upload-path: ./uploads/dev
    max-file-size: 10MB
    allowed-types: jpg,jpeg,png,gif,pdf,doc,docx,xls,xlsx

  # 月度数据导出配置
  data-export:
    enabled: true
    cron: "0 0 2 1 * ?"  # 每月1号凌晨2点执行
    keep-months: 6
    export-path: ./exports/dev
    test-trigger: true  # 开发环境启用测试触发
    export-format: sql
    table-name: device_status_records
    mysqldump-path: /usr/bin/mysqldump
    max-export-duration: 3600  # 开发环境减少执行时间

# 日志配置（开发环境）
logging:
  level:
    com.ems: DEBUG
    org.springframework.security: DEBUG
    org.springframework.web: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr([%thread]){blue} %clr(%-5level){cyan} %clr([%logger{50}]){magenta} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%logger{50}] - %msg%n"
  file:
    name: ./logs/ems-dev.log
    max-size: 10MB
    max-history: 30

# 开发环境特定配置
debug: true