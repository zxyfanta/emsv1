# æ•°æ®ä¸ŠæŠ¥æ¨¡å—è®¾è®¡æ–¹æ¡ˆ V3.0 (æç®€ç‰ˆ)

## ğŸ“‹ æ¥å£åˆ†ææ€»ç»“

æ ¹æ®å®é™…æ¥å£æ–‡æ¡£,éœ€è¦é…ç½®çš„å†…å®¹éå¸¸å°‘:

### å›ºå®šä¸å˜çš„é…ç½®
- âœ… ä¸ŠæŠ¥åœ°å€: `http://59.225.208.12:18085/access/data/report`
- âœ… API Key: `AK-9lKIK7RZrHxPsxq9eYzb2BWBCq8WeSwIPC2e`
- âœ… å…¬é’¥è·å–åœ°å€: `http://59.225.208.12:18085/system/openApi/getPublicKey`
- âœ… æ•°æ®æ ¼å¼: å›ºå®šçš„JSONæ ¼å¼
- âœ… åŠ å¯†æ–¹å¼: SM2(å›ºå®š)

### çœŸæ­£éœ€è¦é…ç½®çš„åªæœ‰3é¡¹:
1. **æ˜¯å¦å¯ç”¨ä¸ŠæŠ¥** - å¼€å…³
2. **ä¸ŠæŠ¥ç²’åº¦** - MIN/HOUR/DAY (å½±å“ `dataType` å­—æ®µ)
3. **GPSä¼˜å…ˆçº§** - BDS/LBS/BDS_THEN_LBS (å½±å“ `LNG`/`LAT` å–å€¼)

---

## ğŸ¯ ç®€åŒ–åçš„è®¾è®¡

### æ–¹æ¡ˆ: åŠŸèƒ½å¼€å…³ + å°‘é‡é…ç½®

ä¸éœ€è¦å¤æ‚çš„é…ç½®è¡¨,åªéœ€è¦åœ¨ä¼ä¸šè¡¨æ·»åŠ å‡ ä¸ªå­—æ®µ:

```sql
ALTER TABLE ems_company ADD COLUMN data_report_enabled BOOLEAN DEFAULT FALSE;
ALTER TABLE ems_company ADD COLUMN data_report_granularity VARCHAR(20) DEFAULT 'HOUR';
ALTER TABLE ems_company ADD COLUMN data_report_gps_priority VARCHAR(20) DEFAULT 'BDS';
```

å°±è¿™ä¹ˆç®€å•!

---

## ğŸ“Š æç®€æ•°æ®åº“è®¾è®¡

### 1. ä¼ä¸šè¡¨æ‰©å±•å­—æ®µ

```sql
-- åœ¨ç°æœ‰ems_companyè¡¨æ·»åŠ å­—æ®µ
ALTER TABLE ems_company
ADD COLUMN data_report_enabled BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å¯ç”¨æ•°æ®ä¸ŠæŠ¥',
ADD COLUMN data_report_granularity VARCHAR(20) DEFAULT 'HOUR' COMMENT 'ä¸ŠæŠ¥ç²’åº¦: MIN/HOUR/DAY',
ADD COLUMN data_report_gps_priority VARCHAR(20) DEFAULT 'BDS' COMMENT 'GPSä¼˜å…ˆçº§: BDS/LBS/BDS_THEN_LBS',
ADD COLUMN data_report_last_time DATETIME COMMENT 'æœ€åä¸ŠæŠ¥æ—¶é—´',
ADD COLUMN data_report_total_count INT DEFAULT 0 COMMENT 'æ€»ä¸ŠæŠ¥æ¬¡æ•°',
ADD COLUMN data_report_success_count INT DEFAULT 0 COMMENT 'æˆåŠŸæ¬¡æ•°',
ADD COLUMN data_report_failure_count INT DEFAULT 0 COMMENT 'å¤±è´¥æ¬¡æ•°';
```

### 2. ä¸ŠæŠ¥æ—¥å¿—è¡¨(ä¿æŒä¸å˜)

```sql
CREATE TABLE ems_data_report_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    company_id BIGINT NOT NULL,
    device_code VARCHAR(50),
    report_time DATETIME NOT NULL,
    granularity VARCHAR(20),
    record_count INT,
    status VARCHAR(20),
    http_status INT,
    response_body TEXT,
    error_message TEXT,
    duration BIGINT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_company_time (company_id, report_time),
    INDEX idx_device_time (device_code, report_time)
) COMMENT='æ•°æ®ä¸ŠæŠ¥æ—¥å¿—è¡¨';
```

---

## ğŸ”§ åç«¯å®ç°

### 1. å®ä½“æ‰©å±•(Companyå®ä½“)

```java
@Data
@Entity
@Table(name = "ems_company")
public class Company extends BaseEntity {

    // ... ç°æœ‰å­—æ®µ ...

    // ========== æ–°å¢æ•°æ®ä¸ŠæŠ¥å­—æ®µ ==========

    @Column(name = "data_report_enabled")
    private Boolean dataReportEnabled = false;

    @Enumerated(EnumType.STRING)
    @Column(name = "data_report_granularity")
    private ReportGranularity dataReportGranularity = ReportGranularity.HOUR;

    @Enumerated(EnumType.STRING)
    @Column(name = "data_report_gps_priority")
    private GpsPriority dataReportGpsPriority = GpsPriority.BDS;

    @Column(name = "data_report_last_time")
    private LocalDateTime dataReportLastTime;

    @Column(name = "data_report_total_count")
    private Integer dataReportTotalCount = 0;

    @Column(name = "data_report_success_count")
    private Integer dataReportSuccessCount = 0;

    @Column(name = "data_report_failure_count")
    private Integer dataReportFailureCount = 0;
}

/**
 * ä¸ŠæŠ¥ç²’åº¦æšä¸¾
 */
public enum ReportGranularity {
    MIN,    // åˆ†é’Ÿçº§ (dataType: "MIN")
    HOUR,   // å°æ—¶çº§ (dataType: "HOUR")
    DAY     // å¤©çº§ (dataType: "DAY")
}

/**
 * GPSä¼˜å…ˆçº§æšä¸¾
 */
public enum GpsPriority {
    BDS,             // ä»…BDS
    LBS,             // ä»…LBS
    BDS_THEN_LBS     // BDSä¼˜å…ˆ,æ— BDSæ—¶ç”¨LBS
}
```

### 2. é…ç½®API

```java
@RestController
@RequestMapping("/companies")
public class CompanyController {

    /**
     * æ›´æ–°ä¼ä¸šæ•°æ®ä¸ŠæŠ¥é…ç½®
     */
    @PutMapping("/{id}/data-report-config")
    @PreAuthorize("hasRole('ADMIN')")
    public ResponseEntity<ApiResponse<Void>> updateDataReportConfig(
        @PathVariable Long id,
        @RequestBody DataReportConfigRequest request
    ) {
        Company company = companyService.findById(id);

        // åªæ›´æ–°ä¸ŠæŠ¥ç›¸å…³å­—æ®µ
        company.setDataReportEnabled(request.getEnabled());
        company.setDataReportGranularity(request.getGranularity());
        company.setDataReportGpsPriority(request.getGpsPriority());

        companyService.updateCompany(id, company);

        return ResponseEntity.ok(ApiResponse.updated());
    }

    /**
     * è·å–å½“å‰ä¼ä¸šçš„æ•°æ®ä¸ŠæŠ¥é…ç½®(æ™®é€šç”¨æˆ·)
     */
    @GetMapping("/current/data-report-config")
    public ResponseEntity<ApiResponse<DataReportConfigResponse>> getDataReportConfig() {
        Long companyId = getCurrentCompanyId();
        Company company = companyService.findById(companyId);

        DataReportConfigResponse response = DataReportConfigResponse.builder()
            .enabled(company.getDataReportEnabled())
            .granularity(company.getDataReportGranularity())
            .gpsPriority(company.getDataReportGpsPriority())
            .lastReportTime(company.getDataReportLastTime())
            .totalCount(company.getDataReportTotalCount())
            .successCount(company.getDataReportSuccessCount())
            .failureCount(company.getDataReportFailureCount())
            .build();

        return ResponseEntity.ok(ApiResponse.success(response));
    }
}

@Data
class DataReportConfigRequest {
    private Boolean enabled;
    private ReportGranularity granularity;
    private GpsPriority gpsPriority;
}

@Data
@Builder
class DataReportConfigResponse {
    private Boolean enabled;
    private ReportGranularity granularity;
    private GpsPriority gpsPriority;
    private LocalDateTime lastReportTime;
    private Integer totalCount;
    private Integer successCount;
    private Integer failureCount;
}
```

### 3. ä¸ŠæŠ¥æœåŠ¡(æ ¸å¿ƒ)

```java
@Service
@Slf4j
public class DataReportService {

    @Value("${app.ems.data-report.url}")
    private String reportUrl;

    @Value("${app.ems.data-report.api-key}")
    private String apiKey;

    @Value("${app.ems.data-report.public-key-url}")
    private String publicKeyUrl;

    private final CompanyRepository companyRepository;
    private final RadiationDeviceDataRepository dataRepository;
    private final DataReportLogRepository logRepository;
    private final SM2EncryptUtil encryptUtil;
    private final RestTemplate restTemplate;

    /**
     * å®šæ—¶ä¸ŠæŠ¥ä»»åŠ¡
     * æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡(å¯ä»¥é…ç½®)
     */
    @Scheduled(cron = "0 0 * * * ?")  // æ¯å°æ—¶æ•´ç‚¹æ‰§è¡Œ
    public void scheduledReport() {
        log.info("å¼€å§‹æ‰§è¡Œæ•°æ®ä¸ŠæŠ¥ä»»åŠ¡...");

        // è·å–æ‰€æœ‰å¯ç”¨äº†ä¸ŠæŠ¥çš„ä¼ä¸š
        List<Company> companies = companyRepository.findByDataReportEnabledTrue();

        for (Company company : companies) {
            try {
                reportCompanyData(company);
            } catch (Exception e) {
                log.error("ä¼ä¸š {} æ•°æ®ä¸ŠæŠ¥å¤±è´¥", company.getCompanyName(), e);
            }
        }
    }

    /**
     * ä¸ºæŒ‡å®šä¼ä¸šä¸ŠæŠ¥æ•°æ®
     */
    public void reportCompanyData(Company company) {
        LocalDateTime startTime = LocalDateTime.now();

        try {
            // 1. ç¡®å®šæ•°æ®æ—¶é—´èŒƒå›´
            LocalDateTime dataStartTime = calculateDataStartTime(company);
            LocalDateTime dataEndTime = startTime;

            // 2. æŸ¥è¯¢è®¾å¤‡æ•°æ®
            List<RadiationDeviceData> dataList = queryDeviceData(
                company,
                dataStartTime,
                dataEndTime
            );

            if (dataList.isEmpty()) {
                log.warn("ä¼ä¸š {} æ²¡æœ‰éœ€è¦ä¸ŠæŠ¥çš„æ•°æ®", company.getCompanyName());
                return;
            }

            // 3. æŒ‰è®¾å¤‡åˆ†ç»„ä¸ŠæŠ¥
            Map<String, List<RadiationDeviceData>> groupedByDevice =
                dataList.stream()
                    .collect(Collectors.groupingBy(d -> d.getDevice().getDeviceCode()));

            int successCount = 0;
            int failureCount = 0;

            for (Map.Entry<String, List<RadiationDeviceData>> entry : groupedByDevice.entrySet()) {
                try {
                    reportDeviceData(company, entry.getKey(), entry.getValue());
                    successCount++;
                } catch (Exception e) {
                    log.error("è®¾å¤‡ {} ä¸ŠæŠ¥å¤±è´¥", entry.getKey(), e);
                    failureCount++;
                }
            }

            // 4. æ›´æ–°ä¼ä¸šä¸ŠæŠ¥ç»Ÿè®¡
            company.setDataReportLastTime(startTime);
            company.setDataReportTotalCount(company.getDataReportTotalCount() + 1);
            company.setDataReportSuccessCount(company.getDataReportSuccessCount() + successCount);
            company.setDataReportFailureCount(company.getDataReportFailureCount() + failureCount);
            companyRepository.save(company);

            log.info("ä¼ä¸š {} æ•°æ®ä¸ŠæŠ¥å®Œæˆ, æˆåŠŸ: {}, å¤±è´¥: {}",
                company.getCompanyName(), successCount, failureCount);

        } catch (Exception e) {
            log.error("ä¼ä¸š {} æ•°æ®ä¸ŠæŠ¥å¤±è´¥", company.getCompanyName(), e);
            company.setDataReportFailureCount(company.getDataReportFailureCount() + 1);
            companyRepository.save(company);
        }
    }

    /**
     * ä¸ŠæŠ¥å•ä¸ªè®¾å¤‡çš„æ•°æ®
     */
    private void reportDeviceData(
        Company company,
        String deviceCode,
        List<RadiationDeviceData> dataList
    ) {
        try {
            // 1. è·å–å…¬é’¥
            String publicKey = encryptUtil.getPublicKey(publicKeyUrl);

            // 2. æ„å»ºä¸ŠæŠ¥è¯·æ±‚
            DataReportRequest request = buildReportRequest(
                company,
                deviceCode,
                dataList
            );

            // 3. åŠ å¯†æ•°æ®
            String jsonData = JsonUtil.toJson(request);
            String encryptedData = encryptUtil.encrypt(jsonData, publicKey);

            // 4. å‘é€HTTPè¯·æ±‚
            HttpHeaders headers = new HttpHeaders();
            headers.setContentType(MediaType.APPLICATION_JSON);
            headers.set("X-Key-ID", apiKey);

            Map<String, String> body = Map.of("data", encryptedData);
            HttpEntity<Map<String, String>> entity = new HttpEntity<>(body, headers);

            long start = System.currentTimeMillis();
            ResponseEntity<String> response = restTemplate.exchange(
                reportUrl,
                HttpMethod.POST,
                entity,
                String.class
            );
            long duration = System.currentTimeMillis() - start;

            // 5. è®°å½•æ—¥å¿—
            DataReportLog log = DataReportLog.builder()
                .company(company)
                .deviceCode(deviceCode)
                .reportTime(LocalDateTime.now())
                .granularity(company.getDataReportGranularity().name())
                .recordCount(dataList.size())
                .status(response.getStatusCode().is2xxSuccessful() ? "SUCCESS" : "FAILED")
                .httpStatus(response.getStatusCode().value())
                .responseBody(response.getBody())
                .duration(duration)
                .build();

            logRepository.save(log);

        } catch (Exception e) {
            // è®°å½•å¤±è´¥æ—¥å¿—
            DataReportLog log = DataReportLog.builder()
                .company(company)
                .deviceCode(deviceCode)
                .reportTime(LocalDateTime.now())
                .granularity(company.getDataReportGranularity().name())
                .status("FAILED")
                .errorMessage(e.getMessage())
                .build();

            logRepository.save(log);

            throw e;
        }
    }

    /**
     * æ„å»ºä¸ŠæŠ¥è¯·æ±‚
     */
    private DataReportRequest buildReportRequest(
        Company company,
        String deviceCode,
        List<RadiationDeviceData> dataList
    ) {
        DataReportRequest request = new DataReportRequest();
        request.setDeviceCode(deviceCode);
        request.setParamType("HTTP");
        request.setDataType(company.getDataReportGranularity().name());
        request.setTimestamp(System.currentTimeMillis());

        // è½¬æ¢æ•°æ®é¡¹
        List<DataItem> items = dataList.stream()
            .map(this::convertToDataItem)
            .collect(Collectors.toList());

        request.setData(items);
        return request;
    }

    /**
     * è½¬æ¢å•æ¡æ•°æ®
     */
    private DataItem convertToDataItem(RadiationDeviceData data) {
        DataItem item = new DataItem();

        // æ•°æ®æ—¶é—´
        item.setDataTime(data.getRecordTime().format(
            DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")
        ));

        // æ„å»ºdataStr
        Map<String, Object> dataMap = new HashMap<>();
        dataMap.put("CODE", data.getDevice().getDeviceCode());
        dataMap.put("Nuclide", data.getDevice().getDescription() != null ?
            data.getDevice().getDescription() : "æœªçŸ¥");
        dataMap.put("GPS", hasValidGps(data) ? 1 : 0);

        if (data.getBatvolt() != null) {
            dataMap.put("Vbat", String.format("%.2fV", data.getBatvolt() / 1000));
        }

        // æ ¹æ®GPSä¼˜å…ˆçº§é€‰æ‹©åæ ‡
        GpsCoordinate coord = selectGpsCoordinate(data);
        if (coord != null) {
            dataMap.put("LNG", coord.getLongitude());
            dataMap.put("LAT", coord.getLatitude());
        }

        dataMap.put("FSY", data.getCpm());

        try {
            item.setDataStr(new ObjectMapper().writeValueAsString(dataMap));
        } catch (Exception e) {
            item.setDataStr("{}");
        }

        return item;
    }

    /**
     * é€‰æ‹©GPSåæ ‡
     */
    private GpsCoordinate selectGpsCoordinate(RadiationDeviceData data) {
        Company company = data.getDevice().getCompany();
        GpsPriority priority = company.getDataReportGpsPriority();

        switch (priority) {
            case BDS:
                if (data.getBdsUseful() != null && data.getBdsUseful() == 1) {
                    return new GpsCoordinate(data.getBdsLongitude(), data.getBdsLatitude());
                }
                return null;

            case LBS:
                if (data.getLbsUseful() != null && data.getLbsUseful() == 1) {
                    return new GpsCoordinate(data.getLbsLongitude(), data.getLbsLatitude());
                }
                return null;

            case BDS_THEN_LBS:
                if (data.getBdsUseful() != null && data.getBdsUseful() == 1) {
                    return new GpsCoordinate(data.getBdsLongitude(), data.getBdsLatitude());
                }
                if (data.getLbsUseful() != null && data.getLbsUseful() == 1) {
                    return new GpsCoordinate(data.getLbsLongitude(), data.getLbsLatitude());
                }
                return null;

            default:
                return null;
        }
    }

    /**
     * æŸ¥è¯¢è®¾å¤‡æ•°æ®
     */
    private List<RadiationDeviceData> queryDeviceData(
        Company company,
        LocalDateTime startTime,
        LocalDateTime endTime
    ) {
        return dataRepository.findByCompanyAndRecordTimeBetween(
            company.getId(),
            startTime,
            endTime
        );
    }

    /**
     * è®¡ç®—æ•°æ®èµ·å§‹æ—¶é—´
     */
    private LocalDateTime calculateDataStartTime(Company company) {
        LocalDateTime lastReport = company.getDataReportLastTime();

        if (lastReport == null) {
            // é¦–æ¬¡ä¸ŠæŠ¥,æ ¹æ®ç²’åº¦å†³å®šæ—¶é—´èŒƒå›´
            switch (company.getDataReportGranularity()) {
                case MIN:
                    return LocalDateTime.now().minusMinutes(10);  // å–æœ€è¿‘10åˆ†é’Ÿ
                case HOUR:
                    return LocalDateTime.now().minusHours(1);    // å–æœ€è¿‘1å°æ—¶
                case DAY:
                    return LocalDateTime.now().minusDays(1);     // å–æœ€è¿‘1å¤©
                default:
                    return LocalDateTime.now().minusHours(1);
            }
        } else {
            return lastReport;
        }
    }

    @Data
    private static class GpsCoordinate {
        private String longitude;
        private String latitude;

        public GpsCoordinate(String longitude, String latitude) {
            this.longitude = longitude;
            this.latitude = latitude;
        }
    }
}
```

### 4. é…ç½®æ–‡ä»¶

```yaml
app:
  ems:
    features:
      data-report-enabled: ${EMS_FEATURE_DATA_REPORT:true}  # å…¨å±€å¼€å…³

    data-report:
      url: ${EMS_DATA_REPORT_URL:http://59.225.208.12:18085/access/data/report}
      api-key: ${EMS_DATA_REPORT_API_KEY:AK-9lKIK7RZrHxPsxq9eYzb2BWBCq8WeSwIPC2e}
      public-key-url: ${EMS_DATA_REPORT_PUBLIC_KEY_URL:http://59.225.208.12:18085/system/openApi/getPublicKey}

      # SM2åŠ å¯†
      sm2:
        enabled: true
        public-key-cache-duration: 3600000  # 1å°æ—¶

      # è°ƒåº¦é…ç½®
      schedule:
        cron: "0 0 * * * ?"  # æ¯å°æ—¶æ•´ç‚¹æ‰§è¡Œ

      # è¶…æ—¶é…ç½®
      timeout:
        connect: 10000  # è¿æ¥è¶…æ—¶10ç§’
        read: 30000     # è¯»å–è¶…æ—¶30ç§’
```

---

## ğŸ¨ å‰ç«¯é¡µé¢

### 1. ç®¡ç†å‘˜:ä¼ä¸šä¸ŠæŠ¥é…ç½®

```vue
<!-- src/views/admin/DataReportConfig.vue -->
<template>
  <div class="data-report-config">
    <el-card>
      <template #header>
        <span>ä¼ä¸šæ•°æ®ä¸ŠæŠ¥é…ç½®</span>
      </template>

      <el-table :data="companies" v-loading="loading">
        <el-table-column prop="companyName" label="ä¼ä¸šåç§°" />
        <el-table-column label="ä¸ŠæŠ¥çŠ¶æ€" width="120">
          <template #default="{ row }">
            <el-switch
              v-model="row.dataReportEnabled"
              @change="handleToggleEnabled(row)"
            />
          </template>
        </el-table-column>
        <el-table-column label="ä¸ŠæŠ¥ç²’åº¦" width="150">
          <template #default="{ row }">
            <el-select
              v-model="row.dataReportGranularity"
              @change="handleUpdateGranularity(row)"
              :disabled="!row.dataReportEnabled"
            >
              <el-option label="åˆ†é’Ÿçº§" value="MIN" />
              <el-option label="å°æ—¶çº§" value="HOUR" />
              <el-option label="å¤©çº§" value="DAY" />
            </el-select>
          </template>
        </el-table-column>
        <el-table-column label="GPSä¼˜å…ˆçº§" width="180">
          <template #default="{ row }">
            <el-select
              v-model="row.dataReportGpsPriority"
              @change="handleUpdateGpsPriority(row)"
              :disabled="!row.dataReportEnabled"
            >
              <el-option label="åŒ—æ–—ä¼˜å…ˆ" value="BDS" />
              <el-option label="åŸºç«™ä¼˜å…ˆ" value="LBS" />
              <el-option label="åŒ—æ–—ç„¶ååŸºç«™" value="BDS_THEN_LBS" />
            </el-select>
          </template>
        </el-table-column>
        <el-table-column prop="dataReportLastTime" label="æœ€åä¸ŠæŠ¥" width="160">
          <template #default="{ row }">
            {{ row.dataReportLastTime || 'æœªä¸ŠæŠ¥' }}
          </template>
        </el-table-column>
        <el-table-column label="æˆåŠŸç‡" width="100">
          <template #default="{ row }">
            {{ calculateSuccessRate(row) }}%
          </template>
        </el-table-column>
        <el-table-column label="æ“ä½œ" width="120">
          <template #default="{ row }">
            <el-button
              size="small"
              @click="handleViewLog(row)"
              :disabled="!row.dataReportEnabled"
            >
              æŸ¥çœ‹æ—¥å¿—
            </el-button>
          </template>
        </el-table-column>
      </el-table>
    </el-card>
  </div>
</template>
```

### 2. æ™®é€šç”¨æˆ·:æˆ‘çš„ä¸ŠæŠ¥çŠ¶æ€

```vue
<!-- src/views/data-report/MyReportStatus.vue -->
<template>
  <div class="my-report-status">
    <el-card>
      <template #header>
        <span>æˆ‘çš„æ•°æ®ä¸ŠæŠ¥</span>
      </template>

      <el-descriptions :column="2" border>
        <el-descriptions-item label="ä¸ŠæŠ¥çŠ¶æ€">
          <el-tag :type="config.enabled ? 'success' : 'info'">
            {{ config.enabled ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨' }}
          </el-tag>
          <el-text v-if="!config.enabled" type="info" style="margin-left: 10px">
            (è¯·è”ç³»ç®¡ç†å‘˜å¯ç”¨)
          </el-text>
        </el-descriptions-item>
        <el-descriptions-item label="ä¸ŠæŠ¥ç²’åº¦">
          {{ getGranularityLabel(config.granularity) }}
        </el-descriptions-item>
        <el-descriptions-item label="GPSä¼˜å…ˆçº§">
          {{ getGpsPriorityLabel(config.gpsPriority) }}
        </el-descriptions-item>
        <el-descriptions-item label="æœ€åä¸ŠæŠ¥">
          {{ config.lastReportTime || 'ä»æœªä¸ŠæŠ¥' }}
        </el-descriptions-item>
        <el-descriptions-item label="ä¸ŠæŠ¥æ¬¡æ•°">
          {{ config.totalCount || 0 }} æ¬¡
        </el-descriptions-item>
        <el-descriptions-item label="æˆåŠŸç‡">
          <el-progress
            :percentage="calculateSuccessRate(config)"
            :color="getSuccessRateColor(calculateSuccessRate(config))"
          />
        </el-descriptions-item>
      </el-descriptions>

      <el-divider />

      <el-space>
        <el-button
          type="primary"
          @click="handleTriggerReport"
          :loading="reporting"
          :disabled="!config.enabled"
        >
          ç«‹å³ä¸ŠæŠ¥
        </el-button>
        <el-button @click="handleViewLog">
          æŸ¥çœ‹æ—¥å¿—
        </el-button>
        <el-button @click="handleViewStats">
          æŸ¥çœ‹ç»Ÿè®¡
        </el-button>
      </el-space>
    </el-card>
  </div>
</template>
```

---

## ğŸ“‹ ç”¨æˆ·æ“ä½œå¯¹æ¯”(æç®€ç‰ˆ)

### ADMINç®¡ç†å‘˜æ“ä½œ

```
1. è¿›å…¥"ä¼ä¸šç®¡ç†"
2. æ‰¾åˆ°éœ€è¦çš„ä¼ä¸š
3. æ“ä½œä¸‰ä¸ªå¼€å…³:
   â˜‘ å¯ç”¨ä¸ŠæŠ¥
   â–¼ ä¸ŠæŠ¥ç²’åº¦: [å°æ—¶çº§ â–¼]  (åˆ†é’Ÿ/å°æ—¶/å¤©)
   â–¼ GPSä¼˜å…ˆçº§: [åŒ—æ–—ä¼˜å…ˆ â–¼]  (åŒ—æ–—/åŸºç«™/åŒ—æ–—ç„¶ååŸºç«™)
4. å®Œæˆ!
```

### USERæ™®é€šç”¨æˆ·æ“ä½œ

```
1. è¿›å…¥"æˆ‘çš„ä¸ŠæŠ¥"
2. æŸ¥çœ‹çŠ¶æ€:
   - ä¸ŠæŠ¥æ˜¯å¦å¯ç”¨
   - ä¸ŠæŠ¥ç²’åº¦
   - GPSä¼˜å…ˆçº§
   - æœ€åä¸ŠæŠ¥æ—¶é—´
   - æˆåŠŸç‡
3. å¯ä»¥ç‚¹å‡»"ç«‹å³ä¸ŠæŠ¥"(å¦‚æœå¯ç”¨äº†)
4. å¯ä»¥æŸ¥çœ‹æ—¥å¿—å’Œç»Ÿè®¡
5. å®Œæˆ!
```

---

## ğŸ¯ æ ¸å¿ƒå¯¹æ¯”

| é…ç½®é¡¹ | æ–¹æ¡ˆV2 | æ–¹æ¡ˆV3(æç®€) |
|-------|--------|--------------|
| æ•°æ®åº“è¡¨ | 2å¼ æ–°è¡¨ | 0å¼ æ–°è¡¨(æ‰©å±•ç°æœ‰è¡¨) |
| é…ç½®é¡¹ | 10+ | 3 |
| å‰ç«¯é¡µé¢ | å¤æ‚è¡¨å• | ç®€å•å¼€å…³ |
| ç®¡ç†å¤æ‚åº¦ | é«˜ | ä½ |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ |
| å®æ–½éš¾åº¦ | ä¸­ | ä½ |

---

## âœ… æ–¹æ¡ˆV3çš„ä¼˜åŠ¿

1. **æç®€é…ç½®** - åªéœ€é…ç½®3é¡¹
2. **æ— éœ€æ–°è¡¨** - æ‰©å±•ç°æœ‰Companyè¡¨å³å¯
3. **é™ä½å‡ºé”™** - é…ç½®é¡¹å°‘,ä¸å®¹æ˜“å‡ºé”™
4. **æ˜“äºç»´æŠ¤** - ä»£ç é‡å°‘,ç»´æŠ¤ç®€å•
5. **ç¬¦åˆéœ€æ±‚** - æ»¡è¶³æ¥å£è¦æ±‚,ä¸è¿‡åº¦è®¾è®¡

---

## ğŸš€ æ¨èé‡‡ç”¨æ–¹æ¡ˆV3

**ç†ç”±:**
- âœ… æ¥å£æœ¬èº«ä¸éœ€è¦å¤ªå¤šé…ç½®
- âœ… ç®€å•å³æ˜¯ç¾
- âœ… é™ä½å®æ–½å’Œç»´æŠ¤æˆæœ¬
- âœ… ç”¨æˆ·ä½“éªŒæ›´å¥½

è¿™ä¸ªæç®€æ–¹æ¡ˆå¦‚ä½•? ğŸ˜Š
